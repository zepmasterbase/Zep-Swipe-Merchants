<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Service Details — Zep Swipe</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>

<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:radial-gradient(circle at top, #050018 0%, #000010 100%);
  --glass:rgba(255,255,255,0.06);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:var(--bg);
  color:#fff;
}
.container{
  max-width:900px;
  margin:28px auto 100px;
  padding:16px;
}
.card{
  background:var(--glass);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  padding:18px;
  backdrop-filter:blur(16px);
}
.title{
  font-family:Orbitron;
  font-size:1.4rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.meta{
  margin-top:6px;
  font-size:12px;
  opacity:.85;
}
.badge{
  display:inline-block;
  margin-left:6px;
  padding:3px 8px;
  border-radius:999px;
  font-size:10px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;
  font-family:Orbitron;
}
.desc{
  margin-top:14px;
  font-size:14px;
  line-height:1.6;
  opacity:.9;
}
.price{
  margin-top:18px;
  font-family:Orbitron;
  font-size:1.3rem;
}
.btn{
  margin-top:16px;
  width:100%;
  padding:14px;
  border-radius:999px;
  border:none;
  font-family:Orbitron;
  font-weight:700;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;
  cursor:pointer;
}
.status{
  margin-top:10px;
  font-size:13px;
  opacity:.85;
}
</style>
</head>

<body>
<div class="container">

  <div class="card">
    <div class="title" id="gigTitle">—</div>
    <div class="meta" id="gigSeller">—</div>

    <div class="desc" id="gigDesc"></div>

    <div class="price" id="gigPrice">—</div>

    <button class="btn" onclick="buyService()">Buy with USDC (Base)</button>
    <div class="status" id="status"></div>
  </div>

</div>

<script>
/* ---------------- CONFIG ---------------- */
const USDC = "0x833589fCD6eDb6E08f4c7C32D4f71b54bda02913"; // USDC on Base
const ERC20_ABI = [
  "function transfer(address to, uint amount) returns (bool)",
  "function decimals() view returns (uint8)"
];

/* ---------------- LOAD GIG ---------------- */
const gig = JSON.parse(localStorage.getItem("activeGig"));

if(!gig){
  alert("No service selected");
  location.href="marketplace.html";
}

document.getElementById("gigTitle").textContent = gig.title;
document.getElementById("gigDesc").textContent = gig.desc;
document.getElementById("gigPrice").textContent = `${gig.price} USDC`;

document.getElementById("gigSeller").innerHTML = `
  ${gig.sellerName}
  <span class="badge">Verified</span><br>
  ${gig.university} · ${gig.country}
`;

/* ---------------- BUY ---------------- */
async function buyService(){
  if(!window.ethereum){
    alert("Install MetaMask or Coinbase Wallet");
    return;
  }

  try{
    document.getElementById("status").textContent = "Processing payment…";

    const provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts",[]);
    const signer = await provider.getSigner();

    const token = new ethers.Contract(USDC, ERC20_ABI, signer);
    const dec = await token.decimals();
    const amount = ethers.parseUnits(gig.price.toString(), dec);

    const tx = await token.transfer(gig.sellerWallet, amount);
    document.getElementById("status").textContent = "Confirming transaction…";
    await tx.wait();

    document.getElementById("status").textContent =
      "✅ Payment successful! Seller will contact you.";

  }catch(e){
    console.error(e);
    document.getElementById("status").textContent = "❌ Transaction failed";
  }
}
</script>

</body>
</html>