<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zep Swipe â€” Connect Wallet</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>

<!-- Coinbase Wallet SDK -->
<script src="https://cdn.jsdelivr.net/npm/@coinbase/wallet-sdk@3.6.0/dist/CoinbaseWalletSDK.min.js"></script>

<style>
:root {
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --glass:rgba(255,255,255,0.06);
  --bg:radial-gradient(circle at 25% 10%, #050018 0%, #000010 100%);
}
body {
  font-family:'Poppins',sans-serif;
  margin:0; color:#fff; background:var(--bg);
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  overflow:hidden; padding:20px;
}
.container {
  width:100%; max-width:420px;
  background:var(--glass);
  border:1px solid rgba(255,255,255,0.1);
  backdrop-filter:blur(20px);
  border-radius:22px;
  padding:2rem 1.8rem;
  box-shadow:0 0 30px rgba(0,240,255,0.25);
  animation:float 3.5s ease-in-out infinite alternate;
  text-align:center;
}
@keyframes float {
  0%{box-shadow:0 0 18px rgba(0,240,255,0.25);}
  100%{box-shadow:0 0 40px rgba(156,77,255,0.45);}
}
h1 {
  font-family:'Orbitron',sans-serif;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-size:1.8rem;
  margin-bottom:.5rem;
}
p.subtitle { opacity:.85; font-size:.95rem; margin-bottom:2rem; }
button.connect {
  width:100%; border:none; border-radius:999px;
  padding:14px; margin-top:1rem;
  font-family:'Orbitron'; font-weight:700; font-size:1rem;
  color:#050018; cursor:pointer; transition:.3s;
  box-shadow:0 0 20px rgba(0,240,255,0.4);
}
.metamask {background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));}
.coinbase {background:linear-gradient(90deg,#0052ff,#00f0ff);}
.phone {
  background:linear-gradient(90deg,#555,#888);
  cursor:not-allowed; color:#fff; opacity:0.7;
}
button.connect:hover:not(.phone){
  transform:scale(1.05);
  box-shadow:0 0 35px rgba(156,77,255,0.7);
}
.status {
  margin-top:1.3rem;
  font-size:.9rem;
  opacity:.9;
  background:rgba(255,255,255,0.05);
  border-radius:10px;
  padding:8px 12px;
}
.footer-note { margin-top:1.8rem; font-size:.8rem; opacity:.6; }
</style>
</head>

<body>
<div class="container">
  <h1>Zep Swipe</h1>
  <p class="subtitle">Login to your <strong>Merchant Dashboard</strong><br>on the Base Network.</p>

  <button class="connect metamask" onclick="connectMetaMask()">ðŸ¦Š Connect MetaMask</button>
  <button class="connect coinbase" onclick="connectCoinbase()">ðŸ’™ Connect Coinbase Wallet</button>
  <button class="connect phone" disabled>ðŸ“± Connect Phone â€” Coming Soon</button>

  <div id="status" class="status">Not connected</div>
  <p class="footer-note">Wallet sessions are stored locally for MVP testing.</p>
</div>

<script>
// === MetaMask (Base network) ===
async function connectMetaMask(){
  if(typeof window.ethereum === 'undefined'){
    alert('MetaMask not detected. Please install it to continue.');
    return;
  }
  try {
    // switch to Base mainnet if needed
    await ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: '0x2105' }] // 8453 Base Mainnet
    }).catch(async (err)=>{
      // add Base if not found
      if(err.code === 4902){
        await ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: '0x2105',
            chainName: 'Base Mainnet',
            nativeCurrency:{ name:'ETH', symbol:'ETH', decimals:18 },
            rpcUrls:['https://mainnet.base.org'],
            blockExplorerUrls:['https://basescan.org']
          }]
        });
      }
    });

    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
    handleWalletConnect(accounts[0],'MetaMask');
  } catch(err){ console.error(err); alert('Connection failed.'); }
}

// === Coinbase Wallet (real Base connection) ===
async function connectCoinbase(){
  try {
    const APP_NAME = "Zep Swipe";
    const APP_LOGO_URL = "https://your-logo.png";
    const DEFAULT_ETH_JSONRPC_URL = "https://mainnet.base.org";
    const DEFAULT_CHAIN_ID = 8453;

    const CoinbaseWalletSDK = window.CoinbaseWalletSDK;
    const wallet = new CoinbaseWalletSDK({ appName: APP_NAME, appLogoUrl: APP_LOGO_URL });
    const ethereum = wallet.makeWeb3Provider(DEFAULT_ETH_JSONRPC_URL, DEFAULT_CHAIN_ID);

    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
    handleWalletConnect(accounts[0],'Coinbase');
  } catch(err){
    console.error(err);
    alert('Coinbase Wallet connection failed.');
  }
}

// === Common Wallet Logic ===
function handleWalletConnect(wallet,type){
  const status=document.getElementById('status');
  status.textContent=`Connected: ${wallet.slice(0,6)}...${wallet.slice(-4)}`;

  const existingUser=JSON.parse(localStorage.getItem('zepUser'));
  if(!existingUser){
    localStorage.setItem('zepUser',JSON.stringify({wallet,type}));
    if(!localStorage.getItem('zacBalance')){
      localStorage.setItem('zacBalance',25);
      alert('ðŸŽ‰ Welcome to Zep Swipe!\nYou earned 25 $ZAC test credits.');
    }
  }else{
    localStorage.setItem('zepUser',JSON.stringify({wallet,type}));
  }

  setTimeout(()=>{window.location.href='merchants-dashboard.html';},1200);
}
</script>
</body>
</html>