<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zep Swipe â€” Connect Wallet</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

<style>
:root {
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
}
*{box-sizing:border-box}
body {
  font-family:'Poppins',sans-serif;
  background:radial-gradient(circle at 25% 10%, #050018 0%, #000010 100%);
  color:#fff;
  height:100vh;
  margin:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
h1 {
  font-family:'Orbitron';
  font-size:2rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:0.6rem;
}
p{
  opacity:0.75;
  max-width:280px;
  text-align:center;
  margin-bottom:1.5rem;
  font-size:0.95rem;
}
button {
  width:260px;
  padding:14px 24px;
  border:none;
  border-radius:999px;
  font-family:'Orbitron';
  font-weight:700;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050018;
  cursor:pointer;
  box-shadow:0 0 25px rgba(0,240,255,0.5);
}
button:hover { transform:scale(1.05); }
footer {
  position:fixed;
  bottom:16px;
  opacity:0.55;
  font-size:0.8rem;
}
</style>
</head>

<body>

<h1>Zep Swipe</h1>
<p>
  Connect your wallet to access the marketplace or manage your verified student services.
</p>

<button onclick="connectWallet()">ðŸ”— Connect Wallet</button>

<footer>Â© 2025 Zep Swipe</footer>

<script>
async function connectWallet() {
  if (!window.ethereum) {
    alert("No wallet detected. Use MetaMask or Coinbase Wallet.");
    return;
  }

  try {
    const accounts = await window.ethereum.request({
      method: "eth_requestAccounts"
    });

    if (!accounts || !accounts.length) return;

    const wallet = accounts[0];

    // Save session for merchants subdomain
    localStorage.setItem("zepUser", JSON.stringify({
      wallet,
      loggedIn: true
    }));

    routeUser(wallet);

  } catch (err) {
    console.error(err);
    alert("Wallet connection failed");
  }
}

/* ---------- ROLE ROUTER ---------- */
function routeUser(wallet){
  const student = JSON.parse(localStorage.getItem("zepStudent"));
  const learn   = JSON.parse(localStorage.getItem("zepLearn")) || {skills:{}};

  // 1ï¸âƒ£ BUYER (no student profile)
  if(!student || student.wallet !== wallet){
    window.location.href = "marketplace.html";
    return;
  }

  // 2ï¸âƒ£ CHECK VERIFICATION (21+ completed days)
  let completedDays = 0;
  Object.values(learn.skills || {}).forEach(s=>{
    completedDays += Math.max(0, (s.day || 1) - 1);
  });

  if(completedDays < 21){
    // Redirect BACK to main app learn & earn
    window.location.href = "https://zepswipe.com/learn-earn.html";
    return;
  }

  // 3ï¸âƒ£ VERIFIED STUDENT
  window.location.href = "merchant-dashboard.html";
}

/* ---------- AUTO LOGIN ---------- */
window.addEventListener("load", ()=>{
  const user = JSON.parse(localStorage.getItem("zepUser"));
  if(user?.loggedIn && user.wallet){
    routeUser(user.wallet);
  }
});
</script>

</body>
</html>